ALTER TABLE [dbo].[Timelines] ADD [SubtreeSize] [int] NOT NULL DEFAULT 0
ALTER TABLE [dbo].[Timelines] ADD [FirstNodeInSubtree] [uniqueidentifier] NOT NULL DEFAULT '00000000-0000-0000-0000-000000000000'
ALTER TABLE [dbo].[Timelines] ADD [Predecessor] [uniqueidentifier] NOT NULL DEFAULT '00000000-0000-0000-0000-000000000000'
ALTER TABLE [dbo].[Timelines] ADD [Successor] [uniqueidentifier] NOT NULL DEFAULT '00000000-0000-0000-0000-000000000000'
ALTER TABLE [dbo].[Users] ALTER COLUMN [NameIdentifier] [nvarchar](4000)
ALTER TABLE [dbo].[Users] ALTER COLUMN [IdentityProvider] [nvarchar](4000)
ALTER TABLE [dbo].[Tours] ALTER COLUMN [AudioBlobUrl] [nvarchar](4000)
INSERT INTO [__MigrationHistory] ([MigrationId], [Model], [ProductVersion]) VALUES ('201306050753190_ProgressiveLoad_AutomaticMigration', 0x1F8B0800000000000400ED5D596F1CB9117E0F90FF3098C700ABD1612C3686B40B4BB2364256B6E1910CE4C9A0A6A911E13E66BB7B0469FF5A1EF293F217C2BE7914AF6EF64CCBD91741C3E32359552CB24856D77FFFFD9FD35F9EA370F684D38C24F1D9FCE8E0703EC3F12A0948BC3E9B6FF3871F7E9AFFF2F35FFF72FA3E889E675F9A722745395A33CECEE68F79BE79BB5864AB471CA1EC2022AB34C99287FC6095440B14248BE3C3C3BF2F8E8E169842CC29D66C76FA791BE724C2E50FFAF322895778936F5178930438CCEA749AB32C51671F5084B30D5AE1B3F9C5639AC4C91F49121DBCA72039C1D97CF62E2488766589C387F96CF3E6ED5D8697392DB75E6E504E5078FBB2C134FF018519AE3BFE76F3C6B6EF87C745DF17288E939CC22571AFB1CFDB51D171955D7F29BA558EED6C7E4E728AF08D2D448BFD13BF700934E9539A6C709ABF7CC60F75D5EB603E5BF0F51662C5B61A53A7689DFE17E727C7F3D9876D18A2FB10B744A2545CE6498A7FC5314E518E834F28CF711A177571D97BA955A18DF323A68D1FDF006D18EA1F0FAC7FE252FF74D1F144CBA95B2AB82189F1EE59F5EB9604CE54B8A413EBD1C46C3DC4727B9FA7182FC91F7818D02DC9C316824E50AA64E6B32BF28C83DF70BCCE1F5B981BF4DCA4D019349FDDC584EA245A294FB7986DB6FAAD6FF5335E53963936FBE67070BB576912FD0BA3B469F912AF4884C2F9EC534AFFAB15EE4FF3D972850AC81EE44C4685BF4AD26F1FE8E8476BE01F98AC1FF33EF056E427699617FDBF8E6B011E348F68AF02BCC25996A4837096DB551F940FE889ACCBC547C0BB782461D0E824BA147EC661592C7B249B6A453C6872BF8A650B09FD9C848C52138A7C5D26DB7455102ED197BB45E91AE7F6BD7EFFFC48EE496EE86F570AE86993A9EE635BC2B577174918E255B5D26BE9C9948368D9666BE8D895817A69BD2AD563FDFF5994F6B396F855B81A018C73BAC9BACE71044F919ADD5FF9829D0C42F9921082853CCF95AE0D68AAC8B99A4EFA9928CC60FF9C2CE34E960BB4A918BEEB9D57DF596A837D8303820AE8DD0FEB2E25BB6FB41C6F3B2977DCF8BB9C3675BFDD8F147D4C039C32F3EEE84723425F2DC9282585A6844B48DA52516CA0C66C3BF43A14661F6DD7475E94DCBECB0AC101F9DCB2A42AC33298CB0238CBE70F6269D9F8EB60E625C936217A297EEC5E05BC8F100977DF6CF1B73A657B209D0ADA5DFBCD091F4D7E22C1F83DB03F7BA393E295C8ED7E04F61267AB94EC69DB452BFFBEC5E6A365C39ABF0D48721E26F777E91EA6DE05CAF13A495F76DFF21253E2C5DD2E4BA29EDB1A749E24DF22947E531CB1D089F49529C29C5E7039F2C1059FEDFB64A540579CAAF05970C77C6D799A01FEA96BB4E6C81EE627A5334E8B69C2996085EC343CAB321C29D8C20EE4C46F6893E15BE6BAC16E164F498B377AC84D8F5B4FADE59636F6A749E1CDA410E829D91550BEA43CC142FD753BBCE6888D70E5D51D668A19FBCD96755B00B611A0FE2B55729D5D8568DD3D1FB88BE996387CA122C04E0F9E483738BAC7A978633CFB82C22D4D389488CA956FCEF29BE247FAE2EC896653E5581E77354236F15D96252B52B249E8A97853C4B7FE3E0E6696D7469D7AEE8870B30D73B209C98A3282D2E2E0401E9FB98586BB162DFC4DA405336E3D39C469A5EAA4727A759D633735DAEE6981815157F3DD4453A741836751EA2EEA0FA658123072EA4203ED9196158D071104BC6B51F5567FF1D2F5B59DE34EB3417B63D38BD4BDE860140ADDBD8E91063A61D0DC068D2F08F2BDB4516BC997D4FE34A274BDED4CDA3E63B7E0BEF602DC595F1BA1772800BCD5ACECA4C28466865E9C6339B21D36BC0103C823D305735CDB3703B381116B19AD30E7C76732B8A1567553BFBBEEFA2A5A3D0E94D0EECDC7DC08E8F6EBB69D0537EFD664314C099BDD7F9F2D98924695F1502CAE88EAA066FF5D3C93456BF13D6855768973FE812F35753A13A499B8F5DB5F79A43C04F3724BC2E894A901A47B532561B48B8601827F7422C1709B0F2314630302481DC70C4085F44310D5AC3011964A2648D45269192A33A7A832675B956C00114419C292E68A00C9C8AC2C32D2D33FA6B4E195A0781E636FFDB583E44477E10ED84C661B406EF2D2A21644924E4F64E268D7032B5B90E93BC7670D39544A9F81AAC5DE0309E007081025CCE6A18B81C8D185D52B5AC2684D423B52F7A012FCEA4EA691D962B4B71999C174AA5B431BAD896849EC41A4D1098FC984B43522FB136577C202BC62D6285DD8A4B4342AFB2B5AC986B4A0EC105AE8C5C368645A9B9903969E5D8A88700B0B50446371DAD89C2C1DAA4D8E8E06B089C960307DF53378833CE8EC4F2B0BD47DFCBBE43F7C7723D3C16C92DA1BA5CC60E44DA786385A3374841D89F6B6C84C22A5B1EA6CAEFA2218649D0E96ACE642ABB549DBBCD345E53B5B279C2E144EB6A73768B321F19A71BAAD5366CBDAE3F687A5BBC36B54612C561CF9450BBA6DA932A185DC8228012EFDB82E518EEE5171FB76114452318305DEB42218E232EB1A8BABA950FCDF7859495EC7ADD92EE07404BCA29D8AE81EAB1C1E66D5A8AAE6ACF07846214A81DB6B2A20DB2856DD80EB6A178EB86CED73E950455BFB58A87DEC54FB44A87D02D53E5D08241379B3909823CC1091D956A2A03372DD6401760AB6120675D571A4A176276101EA247B0CCE239845E232ECF1EAE7152C529D648FD1B8F9B2204D9A3D4AE7B4CBE274A90E634A649C26CDA13FAD132ED79F36D51EA9F1B665719A3487FE005EB55CCF807C7B74CEC99685E5325CE47405A131C993D1451A03D04D15819EA025924913296B4E5711F9501CF234554DD23D8986E118C94D3C94FE8F5622A2ADFD7D8B49EBCDC8A2B48963889B0A817141646198647BACD2A7904529131CFBD2984A526F9A0C7B3CCEE38FC5E332ECF16A273E16A94E9AD0F4D699AAAEB35B75586235B9D595C799DB2EF3724FDCA9CE3386F2053AB1B1E0085C6D243DCB3ADA71DA96CDB0C7AB7DE758A43AC91EA3F8CB3AC2B160629E3DAAECDEC6534DCC9D8C2C564798836D55C989AE8431DAA960B5716451164257E9E35C28F8BD0393E1B04EB6BE6DDC62D9A63AAC709C7F1BB7C471392E3B93C6678DDF9A34A90EF652EB83C6994B6DEA646682EE4AC4F1140F74F52AA18CC778CAAA539D1592C8394A9AE07DC51FB570593D3045E27019F6788C0B168BC624EF4F8BB0BE55D00C8347BAA73926DD760C9D6A5AD7AF12D134E38C08DFFF3695BF0A82CFB3A5D75E7687D75235DBA3EAE2D64B2299F66D984C362BB6B5A810FF0ACAB5DDE8DFC3FA6EAE670F9D3B7691C401295FDD5E67857360EB6666396EF172D05968A4FB675B0BB32E6E6F45024C505C28F7247E09E141341477E7931209C5583D8803FC12D0FA5491ABE5707E08F241F7CEAF273B18202FA2A27BDD382989D10E7CB0DCC06F23ADAE2A843AC36446F798B2273B1A480FE2A27B9D392961518FD9A3A4D86A17A886E5E595960793D428EA67AF93129071B509F078D6720FDB55E82F21CA97B653DAB68A4F7727251D636E58C1C7C4B6168E4683F4B26EA6A943344FA3272526232B11E179B5F9589C2D6D7BDA07911F7C8CDD577914603E64027CDD3D2971500CD58F2038680BB1B8CD55888AE253D510F083F94989C3B8DA017E7CEF7482A93801319C5202DCD03DAEDFF35988CE996052D232D68188D611C14D5CB8AA83CECD2C1C177A3247441E4184D8CE4E71193293C02C5492638658A4BD27A853DADFAD6346EDD56011124DF492A88A149FBCAF9E30D021BD64398E0E8A0207CBDFC3254E9FE810F1C19B22905B53EC06C5E40167F96DF20DC767F3328F8BACD623EAD922CB8270A2A1CF489CD7D35017E4CC35EA581BF5EC9EACCB167A873DEB0B70E204F00A029F6DCB67168479EC332484461F9A0221D0FAC0DCB29F918C9F50BA7A2C9E7E8A513786C4370351AB4F510E0B5F168C1BBECC3BBC18BECC7B037CF83217F861E1CB06CF062094D9604C29ACD96044EE08C98C69F5716F7E4DEF033AFD805CFB5796A368B951758507C11841805F474CABEF54DE84E055DE96D5BE72DC2B3695B75E33A1A7BC610291A5BC610381A3BC617371A132CABF5010DA1D2D4532287B693BB2C2517C13F235E81BB3BAE835439AE3273FAC84CE204665E97E42420D5F3CE4F050DE58CA457FF2865AFC95833B798357C56EEAD9C0C443330D969F51040788DFE14FCF084196FA6C98A0104BDE3A284650F2062C0648DACFAAFB0A62084D73528C216B6034A03E330288FF33988A522CA01E023BA6269103FDF432BE9A3BFB5127D3DEA3067D8FBB4E15F5FDC585F119EFA0BA82B2C0933FA65ECFEE9CA0F02289B33C4544F6CBF994927845362814C720DF4DDA085741DE1652CCB9C41B1C175C82C668D39EE145618B2FC8BB8910230584109FDEF4F8807F7FF1F2240E5ABFB5D104C2AA2DE36DFD0EC4C121388C6F69683F5BCF805987967905B2A0FEA0D33445C13D4C8E8F6562F752B0CB05C24506F6BF36388710F3AB10B800141CA04300B257A018F49FF29AA672E8134CCD43E0B4FD8984CBCCDDB13CE8FDDA76A227349FB466B8D73DCD758A75344CC978E2BFE2CB4F2330DF49F5689E07EF80F11E424B798C23B52FD1307F0F63DF5262F71878177B4ACB4874DE2DCD320214BB3BB58A63F70A360F8AAF804D73D7E0107871689CC52E64178363195AB1B72561CB8B813CD77CEB0A3023D47E677B582146DF1F0C585E5ED94EA1CFB2B3CBED82E038D1AA21311484C8C9DA9346F02AD0845BACDC24CEE6C17D42D95D9D9277611A2549E1F1BB630AA9812E0B6A411DB94E6CA23575A416DA1CA80165DC26119F337EA436B85CA81D6D0431B9AD6EF6004D31BE96604BEAD8286243D5D4979AA83DF5007038608DC4EE722591595D26836C86C20D2983476A63478272AA8CC4243621292FA925A904D4A029F6CD1EE34F82E1BE0055A5BA53B2A83D959867321F45DF419B618F35E41182000E1BB0A041B9CF8078E4B0EF087FEE023DEE40478D0E3A84BFC00A267D32CAA7588F11F6D386677B18B4E4E53E24282EBB28771F36D70FD2512E5E4988395D3CB9BD13C46B48C6814B15B3DFEABEB9E16988FE426E1ABBA8385B606A2963844F269EA4FBEC1D20F47E821DCABEF3D420DDD2DA51F5D2891AC519597710C58701E2AA431D6853E63A7E481A9358E8515344726DC95140EDD477694E1ED02AA7D985772489D7F3D917146E0BED1FDDE3E03AFEB8CD37DB9C0E1947F721F7ADF6C2B2D6B55F4674E4FB7CFAB17C2998F91802ED26A143C01FE3F32DDD8FB7FDBE023CC8151085C95E7BD617BCCC0B0FFBF54B8BF4211137352AA09A7CED49C32D8E362105CB3EC64BF484D57D33D390A7D8E92541EB1445598DD1D5A73FA9F805D1F3CFFF0380B9125836AF0000, '5.0.0.net45')
INSERT INTO [__MigrationHistory] ([MigrationId], [Model], [ProductVersion]) VALUES ('201306050753190_ProgressiveLoad', 0x1F8B0800000000000400ED5D596F1CB9117E0F90FF3098C700ABD1612C3686B40B4BB2364256B6E1910CE4C9A0A6A911E13E66BB7B0469FF5A1EF293F217C2BE7914AF6EF64CCBD91741C3E32359552CB24856D77FFFFD9FD35F9EA370F684D38C24F1D9FCE8E0703EC3F12A0948BC3E9B6FF3871F7E9AFFF2F35FFF72FA3E889E675F9A722745395A33CECEE68F79BE79BB5864AB471CA1EC2022AB34C99287FC6095440B14248BE3C3C3BF2F8E8E169842CC29D66C76FA791BE724C2E50FFAF322895778936F5178930438CCEA749AB32C51671F5084B30D5AE1B3F9C5639AC4C91F49121DBCA72039C1D97CF62E2488766589C387F96CF3E6ED5D8697392DB75E6E504E5078FBB2C134FF018519AE3BFE76F3C6B6EF87C745DF17288E939CC22571AFB1CFDB51D171955D7F29BA558EED6C7E4E728AF08D2D448BFD13BF700934E9539A6C709ABF7CC60F75D5EB603E5BF0F51662C5B61A53A7689DFE17E727C7F3D9876D18A2FB10B744A2545CE6498A7FC5314E518E834F28CF711A177571D97BA955A18DF323A68D1FDF006D18EA1F0FAC7FE252FF74D1F144CBA95B2AB82189F1EE59F5EB9604CE54B8A413EBD1C46C3DC4727B9FA7182FC91F7818D02DC9C316824E50AA64E6B32BF28C83DF70BCCE1F5B981BF4DCA4D019349FDDC584EA245A294FB7986DB6FAAD6FF5335E53963936FBE67070BB576912FD0BA3B469F912AF4884C2F9EC534AFFAB15EE4FF3D972850AC81EE44C4685BF4AD26F1FE8E8476BE01F98AC1FF33EF056E427699617FDBF8E6B011E348F68AF02BCC25996A4837096DB551F940FE889ACCBC547C0BB782461D0E824BA147EC661592C7B249B6A453C6872BF8A650B09FD9C848C52138A7C5D26DB7455102ED197BB45E91AE7F6BD7EFFFC48EE496EE86F570AE86993A9EE635BC2B577174918E255B5D26BE9C9948368D9666BE8D895817A69BD2AD563FDFF5994F6B396F855B81A018C73BAC9BACE71044F919ADD5FF9829D0C42F9921082853CCF95AE0D68AAC8B99A4EFA9928CC60FF9C2CE34E960BB4A918BEEB9D57DF596A837D8303820AE8DD0FEB2E25BB6FB41C6F3B2977DCF8BB9C3675BFDD8F147D4C039C32F3EEE84723425F2DC9282585A6844B48DA52516CA0C66C3BF43A14661F6DD7475E94DCBECB0AC101F9DCB2A42AC33298CB0238CBE70F6269D9F8EB60E625C936217A297EEC5E05BC8F100977DF6CF1B73A657B209D0ADA5DFBCD091F4D7E22C1F83DB03F7BA393E295C8ED7E04F61267AB94EC69DB452BFFBEC5E6A365C39ABF0D48721E26F777E91EA6DE05CAF13A495F76DFF21253E2C5DD2E4BA29EDB1A749E24DF22947E531CB1D089F49529C29C5E7039F2C1059FEDFB64A540579CAAF05970C77C6D799A01FEA96BB4E6C81EE627A5334E8B69C2996085EC343CAB321C29D8C20EE4C46F6893E15BE6BAC16E164F498B377AC84D8F5B4FADE59636F6A749E1CDA410E829D91550BEA43CC142FD753BBCE6888D70E5D51D668A19FBCD96755B00B611A0FE2B55729D5D8568DD3D1FB88BE996387CA122C04E0F9E483738BAC7A978633CFB82C22D4D389488CA956FCEF29BE247FAE2EC896653E5581E77354236F15D96252B52B249E8A97853C4B7FE3E0E6696D7469D7AEE8870B30D73B209C98A3282D2E2E0401E9FB98586BB162DFC4DA405336E3D39C469A5EAA4727A759D633735DAEE6981815157F3DD4453A741836751EA2EEA0FA658123072EA4203ED9196158D071104BC6B51F5567FF1D2F5B59DE34EB3417B63D38BD4BDE860140ADDBD8E91063A61D0DC068D2F08F2BDB4516BC997D4FE34A274BDED4CDA3E63B7E0BEF602DC595F1BA1772800BCD5ACECA4C28466865E9C6339B21D36BC0103C823D305735CDB3703B381116B19AD30E7C76732B8A1567553BFBBEEFA2A5A3D0E94D0EECDC7DC08E8F6EBB69D0537EFD664314C099BDD7F9F2D98924695F1502CAE88EAA066FF5D3C93456BF13D6855768973FE812F35753A13A499B8F5DB5F79A43C04F3724BC2E894A901A47B532561B48B8601827F7422C1709B0F2314630302481DC70C4085F44310D5AC3011964A2648D45269192A33A7A832675B956C00114419C292E68A00C9C8AC2C32D2D33FA6B4E195A0781E636FFDB583E44477E10ED84C661B406EF2D2A21644924E4F64E268D7032B5B90E93BC7670D39544A9F81AAC5DE0309E007081025CCE6A18B81C8D185D52B5AC2684D423B52F7A012FCEA4EA691D962B4B71999C174AA5B431BAD896849EC41A4D1098FC984B43522FB136577C202BC62D6285DD8A4B4342AFB2B5AC986B4A0EC105AE8C5C368645A9B9903969E5D8A88700B0B50446371DAD89C2C1DAA4D8E8E06B089C960307DF53378833CE8EC4F2B0BD47DFCBBE43F7C7723D3C16C92DA1BA5CC60E44DA786385A3374841D89F6B6C84C22A5B1EA6CAEFA2218649D0E96ACE642ABB549DBBCD345E53B5B279C2E144EB6A73768B321F19A71BAAD5366CBDAE3F687A5BBC36B54612C561CF9450BBA6DA932A185DC8228012EFDB82E518EEE5171FB76114452318305DEB42218E232EB1A8BABA950FCDF7859495EC7ADD92EE07404BCA29D8AE81EAB1C1E66D5A8AAE6ACF07846214A81DB6B2A20DB2856DD80EB6A178EB86CED73E950455BFB58A87DEC54FB44A87D02D53E5D08241379B3909823CC1091D956A2A03372DD6401760AB6120675D571A4A176276101EA247B0CCE239845E232ECF1EAE7152C529D648FD1B8F9B2204D9A3D4AE7B4CBE274A90E634A649C26CDA13FAD132ED79F36D51EA9F1B665719A3487FE005EB55CCF807C7B74CEC99685E5325CE47405A131C993D1451A03D04D15819EA025924913296B4E5711F9501CF234554DD23D8986E118C94D3C94FE8F5622A2ADFD7D8B49EBCDC8A2B48963889B0A817141646198647BACD2A7904529131CFBD2984A526F9A0C7B3CCEE38FC5E332ECF16A273E16A94E9AD0F4D699AAAEB35B75586235B9D595C799DB2EF3724FDCA9CE3386F2053AB1B1E0085C6D243DCB3ADA71DA96CDB0C7AB7DE758A43AC91EA3F8CB3AC2B160629E3DAAECDEC6534DCC9D8C2C564798836D55C989AE8431DAA960B5716451164257E9E35C28F8BD0393E1B04EB6BE6DDC62D9A63AAC709C7F1BB7C471392E3B93C6678DDF9A34A90EF652EB83C6994B6DEA646682EE4AC4F1140F74F52AA18CC778CAAA539D1592C8394A9AE07DC51FB570593D3045E27019F6788C0B168BC624EF4F8BB0BE55D00C8347BAA73926DD760C9D6A5AD7AF12D134E38C08DFFF3695BF0A82CFB3A5D75E7687D75235DBA3EAE2D64B2299F66D984C362BB6B5A810FF0ACAB5DDE8DFC3FA6EAE670F9D3B7691C401295FDD5E67857360EB6666396EF172D05968A4FB675B0BB32E6E6F45024C505C28F7247E09E141341477E7931209C5583D8803FC12D0FA5491ABE5707E08F241F7CEAF273B18202FA2A27BDD382989D10E7CB0DCC06F23ADAE2A843AC36446F798B2273B1A480FE2A27B9D392961518FD9A3A4D86A17A886E5E595960793D428EA67AF93129071B509F078D6720FDB55E82F21CA97B653DAB68A4F7727251D636E58C1C7C4B6168E4683F4B26EA6A943344FA3272526232B11E179B5F9589C2D6D7BDA07911F7C8CDD577914603E64027CDD3D2971500CD58F2038680BB1B8CD55888AE253D510F083F94989C3B8DA017E7CEF7482A93801319C5202DCD03DAEDFF35988CE996052D232D68188D611C14D5CB8AA83CECD2C1C177A3247441E4184D8CE4E71193293C02C5492638658A4BD27A853DADFAD6346EDD56011124DF492A88A149FBCAF9E30D021BD64398E0E8A0207CBDFC3254E9FE810F1C19B22905B53EC06C5E40167F96DF20DC767F3328F8BACD623EAD922CB8270A2A1CF489CD7D35017E4CC35EA581BF5EC9EACCB167A873DEB0B70E204F00A029F6DCB67168479EC332484461F9A0221D0FAC0DCB29F918C9F50BA7A2C9E7E8A513786C4370351AB4F510E0B5F168C1BBECC3BBC18BECC7B037CF83217F861E1CB06CF062094D9604C29ACD96044EE08C98C69F5716F7E4DEF033AFD805CFB5796A368B951758507C11841805F474CABEF54DE84E055DE96D5BE72DC2B3695B75E33A1A7BC610291A5BC610381A3BC617371A132CABF5010DA1D2D4532287B693BB2C2517C13F235E81BB3BAE835439AE3273FAC84CE204665E97E42420D5F3CE4F050DE58CA457FF2865AFC95833B798357C56EEAD9C0C443330D969F51040788DFE14FCF084196FA6C98A0104BDE3A284650F2062C0648DACFAAFB0A62084D73528C216B6034A03E330288FF33988A522CA01E023BA6269103FDF432BE9A3BFB5127D3DEA3067D8FBB4E15F5FDC585F119EFA0BA82B2C0933FA65ECFEE9CA0F02289B33C4544F6CBF994927845362814C720DF4DDA085741DE1652CCB9C41B1C175C82C668D39EE145618B2FC8BB8910230584109FDEF4F8807F7FF1F2240E5ABFB5D104C2AA2DE36DFD0EC4C121388C6F69683F5BCF805987967905B2A0FEA0D33445C13D4C8E8F6562F752B0CB05C24506F6BF36388710F3AB10B800141CA04300B257A018F49FF29AA672E8134CCD43E0B4FD8984CBCCDDB13CE8FDDA76A227349FB466B8D73DCD758A75344CC978E2BFE2CB4F2330DF49F5689E07EF80F11E424B798C23B52FD1307F0F63DF5262F71878177B4ACB4874DE2DCD320214BB3BB58A63F70A360F8AAF804D73D7E0107871689CC52E64178363195AB1B72561CB8B813CD77CEB0A3023D47E677B582146DF1F0C585E5ED94EA1CFB2B3CBED82E038D1AA21311484C8C9DA9346F02AD0845BACDC24CEE6C17D42D95D9D9277611A2549E1F1BB630AA9812E0B6A411DB94E6CA23575A416DA1CA80165DC26119F337EA436B85CA81D6D0431B9AD6EF6004D31BE96604BEAD8286243D5D4979AA83DF5007038608DC4EE722591595D26836C86C20D2983476A63478272AA8CC4243621292FA925A904D4A029F6CD1EE34F82E1BE0055A5BA53B2A83D959867321F45DF419B618F35E41182000E1BB0A041B9CF8078E4B0EF087FEE023DEE40478D0E3A84BFC00A267D32CAA7588F11F6D386677B18B4E4E53E24282EBB28771F36D70FD2512E5E4988395D3CB9BD13C46B48C6814B15B3DFEABEB9E16988FE426E1ABBA8385B606A2963844F269EA4FBEC1D20F47E821DCABEF3D420DDD2DA51F5D2891AC519597710C58701E2AA431D6853E63A7E481A9358E8515344726DC95140EDD477694E1ED02AA7D985772489D7F3D917146E0BED1FDDE3E03AFEB8CD37DB9C0E1947F721F7ADF6C2B2D6B55F4674E4FB7CFAB17C2998F91802ED26A143C01FE3F32DDD8FB7FDBE023CC8151085C95E7BD617BCCC0B0FFBF54B8BF4211137352AA09A7CED49C32D8E362105CB3EC64BF484D57D33D390A7D8E92541EB1445598DD1D5A73FA9F805D1F3CFFF0380B9125836AF0000, '5.0.0.net45')
ALTER TABLE [dbo].[Users] ALTER COLUMN [NameIdentifier] [nvarchar](max)
ALTER TABLE [dbo].[Users] ALTER COLUMN [IdentityProvider] [nvarchar](max)
ALTER TABLE [dbo].[Tours] ALTER COLUMN [AudioBlobUrl] [nvarchar](max)
INSERT INTO [__MigrationHistory] ([MigrationId], [Model], [ProductVersion]) VALUES ('201306050809089_AutomaticMigration', 0x1F8B0800000000000400ED5D596F1CB9117E0F90FF3098A724C06A74180BC790766149D646C8CA363C92813C19D4343522DCC76C778F21ED5FCB437E52FE42D8378FE2D5CD9E6939FB2268787C24AB8A4516C9EAFAEFBFFF73FAF35314CEBEE13423497C363F3A389CCF70BC4A0212AFCFE6DBFCE187D7F39F7FFAF39F4EDF05D1D3EC7353EEA428476BC6D9D9FC31CF376F168B6CF58823941D4464952659F2901FAC9268818264717C78F8F7C5D1D102538839C59ACD4E3F6DE39C44B8FC417F5E24F10A6FF22D0A6F920087599D4E739625EAEC3D8A70B6412B7C36BF784C9338F93D49A28377142427389BCFDE8604D1AE2C71F8309F6D5EBDB9CBF032A7E5D6CB0DCA090A6F9F3798E63FA030C375C7DF6C5ED9F6FDF0B8E8FB02C5719253B824EE35F6793B2A3AAEB2EBCF45B7CAB19DCDCF494E11BEB28568B17FE2672E81267D4C930D4EF3E74FF8A1AE7A1DCC670BBEDE42ACD85663EA14ADD3FFE2FCE4783E7BBF0D43741FE29648948ACB3C49F12F38C629CA71F011E5394EE3A22E2E7B2FB52AB4717EC4B4F1E32BA00D43FDE381F54F5CEA9F2E3A9E6839754B05372431DE3DAB7ED992C0990A9774623D9A98AD87586EEFF314E325F91D0F03BA2579D842D0094A95CC7C76459E70F02B8ED7F9630B73839E9A143A83E6B3BB98509D442BE5E916B3CD56BFF5AD7EC26BCA32C7665F1D0E6EF72A4DA27F6194362D5FE2158950389F7D4CE97FB5C27D3D9F2D57A880EC41CE6454F8AB24FDFA9E8E7EB406FE81C9FA31EF036F457E926679D1FFEBB816E041F388F62AC02B9C65493A0867B95DF541798FBE9175B9F80878178F240C1A9D4497C24F382C8B658F6453AD88074DEE17B16C21A19F9290516A42912FCB649BAE0AC225FA72B7285DE3DCBED7EF9E1EC93DC90DFDED4A013D6D32D57D6C4BB8F6EE220943BCAA567A2D3D9972102DDB6C0D1DBB32502FAD57A57AACFF3F8BD27ED612BF0A572380714E3759D7398EE02952B3FB0B5FB09341285F1242B090E7B9D2B5014D153957D3493F138519EC1F9365DCC972813615C377BDF3EA3B4B6DB06F70405001BDFB61DDA564F78D96E36D27E58E1B7F9BD3A6EEB7FB91A20F69805366DE1DFD6844E8AB2519A5A4D0947009495B2A8A0DD4986D875E86C2ECA3EDFAC88B92DB77592138209F5B965465580673590067F9FC412C2D1B7F19CCBC24D92644CFC58FDDAB80771122E1EE9B2DFE56A76C0FA4534196EDD37F0736DF1CF0D1E46F2418BD03F6276F744ABC10A9DD8FB85EE26C95923D6DBA68E5DFB6D87CB06C58F1B70149CEC3E4FE2E759D78C305FF02E5789DA4CFBB27DE1253DAC5DD164B229EDB02749E245F23947E559CAFD079F48529C21C5D7039F2A9059FEDFB58A540571CA9F05970C77CED779A01FEA16AB4B6C81ED6454A679C16D384B3BF0AD9697856653852B0851DC8895FD126C3B7CC5D83DD2C9E92126FF4909B1AB79E5ACB2D6DEC0F7BC29B3D21D053322AA07C49798285FAEB7678CD111BE1CAAB3BCC1433F69B2DEBB6006C2340FD57AAE43ABB0AD1BA7B3B7017D30D71F84C45809D1E3C916E70748F53F1BA78F619855B9A702811952BDF1CE437C58FF4C5D9E3CCA6CAB13CEE6A846CE2DB2C4B56A46493D053F19A886FFD5D1CCC2CEF8C3AF5DC11E1661BE6641392156504A5C5C1813C3E730B0D772D5AF89B480B66DC7A7288D34AD549E5F4EA3AC76E6AB4DDD30203A3AEE6BB89A64E83060FA2D45DD49F4AB12460E4D48506DAF32C2B1A0F220878D1A2EAADFED6A5EB6B3BC79D6683F6BAA617A97BD1C12814BA4B1D230D74C2A0B90A1A5F10E44B69A3D6926FA8FD6944E96EDB99B47DC66EC17DEDEDB7B3BE3642EF500078AB59D9498509CD0CBD38C672643B6C7803069047A60BE6B8B66F06660323D6325A61CE8FCF647043ADEAA67E77DDF555B47A1C28A1DD9B8FB911D0EDD76D3B0B6EDEADC962981236BBFF3E5B30258D2AE3A1585C11D541CDFEBB78238BD6E263D0AAEC12E7FCEB5E6AEA7426483371EB87BFF2487908E6D99684D129530348F7A04AC268170D0304FFE24482E1361F4628C60604903A8E19800AE98720AA5961222C954C90A8A5D23254664E5165CEB62AD9002288328425CD15019291595964A4777F4C69C31341F13CC6DEFA6B07C989EEC21DB099CC3680DCE4A5452D88249D9EC8C4D1AE0756B620D3778ECF1A72A8943E03558BBD0712C0AF0F204A98CD43170391A30BAB57B484D19A8476A4EE4125F8C99D4C23B3C5686F333283E954B786365A13D192D88348A3131E9309696B44F627CAEE840578C2AC51BAB049696954F657B4920D6941D921B4D08B87D1C8B43633072C3DBB1411E11616A088C6E2B4B139593A549B1C1D0D601393C160FAEA67F00679D0D99F5616A8FBF877C97FF8EE46A683D924B5374A99C1C89B4E0D71B466E8083B12ED6D9199444A63D5D95CF54530C83A1D2C59CD85566B93B679A78BCA71B64E385D283C6C4F6FD06643E235E3715BA7CC96B5BBED0F4B776FD7A8C258AC38F28B1674DB5265420BB90551025C3A715DA21CDDA3E2F6ED2288A462060BBC694530C465D635165753A1F8BF71B1925C8E5BB35DC0E90878453B15D13D56393CCCAA5155CD59E1EE8C429402B7D75440B651ACBA01D7D52EBC70D9DAE7D2A18AB6F6B150FBD8A9F68950FB04AA7DBA104826F266213147982122B3AD444167E4BAC902EC116C250CEAAAE34843ED4BC202D449F6189C3B308BC465D8E3D5CF2B58A43AC91EA3F1F165419A347B94CE6397C5E9521DC694C8384D9A437F5A0F5CAE3F6DAA3D52E36ACBE234690EFD015C6AB99E01F9F6E89C872D0BCB65B8C8E90A42639227A38B3406A09B2A02DD404B24932652D69CAE22F2A138E469AA9AA47B120DC331929B78289D1FAD44445BFBFB1693D69591456913C710371502E37FC8C230C9F658A543218B522638F6A53195A4DE3419F6789CBB1F8BC765D8E3D51E7C2C529D34A1E9AD33555D67B7EAB0C46A72AB2B8F33B75DE6E59EB8539D670CE50B746263C111B8DA487A96F5B2E3B42D9B618F573BCEB14875923D46F197F58263C1C43C7B54D9B98DA79A983B1959AC8E3007DBAA920F5D0963B453C16AE3C8A22C84AED2C7B950F07B0726C3619D6C5DDBB8C5B24D7558E138F7366E89E3725C76268DCF1ABF3569521DECA5D6078D3397DAD4C9CC04DD9588E3291EE8EA5542198FF19455A73A2B2491739434C1FB8A3F6AE1B27A608AC4E132ECF118172C168D49DE9F16617DABA019068F744F734CBAED183AD5B4AE5F25A269C61911BEFF6D2A7F15049F674BAFBDEC0EAFA56AB647D5C5AD974432EDDB30996C566C6B5121FE15946BBBD1BF87F5DD5CCF1E3A77EC22890352BEBABDCE0AE7C0D6CDCC72DCE2E5A0B3D048F7CFB616665DDCDE8A0498A0B850EE49FC12C2836828EECE2725128AB17A1007F825A0F5A92257CBE1FC10E483EE9D5F4F7630405E4445F7BA715212A31DF860B981DF465A5D55087586C98CEE31654F7634901EC445F73A7352C2A21EB34749B1D52E500DCBCB2B2D0F26A951D4CF5E272520E36A13E0F1ACE51EB6ABD05F42942F6DA7B46D159FEE4E4A3AC6DCB0828F896D2D1C8D06E965DD4C5387689E464F4A4C465622C2F36AF3B1385BDAF6B40F223FF818BBAFF228C07CC804F8BA7B52E2A018AA1F4170D01662719BAB1015C5A7AA21E007F393128771B503FCF8DEE9045371026238A504B8A17B5CBFE7B3109D33C1A4A465AC0311AD23829BB87055079D9B59382EF4648E883C8208B19D9DE23264268159A824C70CB1487B4F50A7B4BF5BC78CDAABC1221E9AE825511529BE775F3D61A0437ACE721C1D14050E96BF851721C171DE15B8413179C0597E9B7CC571F9DDFFD74244B51ED1CE16591684130D79468AD11B839BB9461B6BA39DDD9375D942EF70677D014E9C005E40C0B36DF9C28230EF7C8684CEE8435320F4591F985BF60B92F13794AE1E8B579F62B48D2171CD40D4EA2B94C3C29605E3862DF30E2F862DF3DE001FB6CC057E58D8B2C1B30108613618530A673618913B3D32635A7DD79B5FCEFB804E3F10D7FE95E5285A6E545DE141304610E09711CBEA3B9537216895B765B5AF1CF78A49E5ADD74CC8296F984044296FD840C0286FD85C3CA88CF22F148476474B910CCADED78EAC70149F837C09FAC6AC2E7ACD90E6E4C90F2BA1E3875159BA9F5050C3170F392C94379672519FBCA1167FE5A04E0DFC5F22F4F4575F819A1C40271E7C69B09C8C222040880E7FFA4408A3D467630405511A24686260246FA315E31EED67457D01A181A6391100F91A8C0906F9E9330B80B03E83A92885F8E921B0636A0F397E4F2FC3AAB98A1F7532ED3D18D0F7B8A35451DF5FB8179F610CAAEB250B3CF91BE9F5ECCE090A2F9238CB534464779B8F298957648342710CF295A38D7015E46D21C59C4BBCC171C125688C36ED191E0AB6F882BC9B0831529C07F1454D8FEFF2F7172F4FE2A075471B4D20ACDA325EC2EF401C1C62BEF89686F66BF40C9875C49817200BEAEF344D5314DCA3DFF85826762F05BB5C205C6460FF6B83736430BF0A818B2BC1013AC4157B018A41FF85AE692A873E31D23CC443DB9F48B8CCDC1DCB83DE5D6D277A42F3A56A867BDD8B5BA71046C3948C27FE2B3EE83402F39D548FE6D5EF0E18EF216294C7F050FB120DF3672EF62D25766F7C77B1A7B40C30E7DDD22C033BB1BB53ABF0742F60F3A0F8B8D734770D0EF11487864FEC227131389611137B5B12B6BC18C873CD27AC003342ED4EB6871562F4FDC180E5E585ED14FA2C3BBBDC2E08FE10AD1A12233C889CAC1D64048F014D14C5CAFBE16C1EDC2794DDD52979177D5192141EBF3BA6901AE8B2A016D401E9C4265A53476AA1CD811A50866312F139E3476A83CB85DAD1060693DBEA660FD014E34209B6A40E792236544D7DA989DA010F0087E3D048EC2E571299D56532C866288A903226A436242428A7CA004B621392F2925A924A400D9A42DAEC31AC2418C50B5055AA3B258BDA53096526F3517409B419F658431E21B6DFB0010B1A94FBBA87470EFB0EDCE72ED0E30E74D4A09F43F80BAC60D297A07C8AF518D13C6D78B687414BCEEB4362DDB28B72F7BD72FD201DE5E285448ED38589DB3B41BC465A1CB85431FBADEE531A9E86E82F92A6B18B8AB305A69632F4F764C244BACFDE0142EF2786A1EC124F0DD22DAD1D552F9DA8519C91750751F8FBC755873AD0A6CC75FC903426B1D0A3A688E4B692A380DAA96FD39C3CA0554EB30BCF4712AFE7B3CF28DC16DA3FBAC7C175FC619B6FB6391D328EEE43EE13EC8565AD6BBF0CD4C8F7F9F443F95230F33104DA4D4287803FC4E75BBA1F6FFB7D0578872B200A93BDF69A2F789917DEF3EBE716E97D226E6A544035F9DA93865B1C6D420A967D8897E81B56F7CD4C439E62A79704AD5314653546579FFEA4E217444F3FFD0F636D61B80AAF0000, '5.0.0.net45')

SELECT COunt(*) FROM ContentItems

GO

CREATE PROCEDURE TimelineSubtreeQuery
	@Collection_Id UNIQUEIDENTIFIER,
	@LCA UNIQUEIDENTIFIER,
	@min_span DECIMAL,
	@startTime DECIMAL,
	@endTime DECIMAL,
	@max_elem INT
AS
BEGIN
	DECLARE @return_entire_subtree BIT
	DECLARE @subtree_size INT
	DECLARE @current_level_cnt INT
	DECLARE @cnt INT
	DECLARE @num_ge_min_span INT
	DECLARE @current_id UNIQUEIDENTIFIER
	DECLARE @current_level TABLE (
		Id UNIQUEIDENTIFIER
	)
	DECLARE @next_level TABLE (
		Id UNIQUEIDENTIFIER
	)
	DECLARE @results TABLE (
		Id UNIQUEIDENTIFIER
	)
	DECLARE cur CURSOR FOR SELECT Id FROM @current_level
	SET @return_entire_subtree = 0
	SET @subtree_size = 0
	IF @LCA = CAST(CAST(0 AS BINARY) AS UNIQUEIDENTIFIER)
		INSERT INTO @current_level SELECT Id FROM Timelines WHERE Depth = 0 AND Collection_ID =  @Collection_Id
	ELSE
	BEGIN
		INSERT INTO @current_level VALUES (@LCA)
		SELECT @subtree_size=SubtreeSize FROM Timelines WHERE Id = @LCA
		IF @subtree_size <= @max_elem
			SET @return_entire_subtree = 1
	END
	IF @return_entire_subtree = 1
	BEGIN
		SELECT @current_id=FirstNodeInSubtree FROM Timelines WHERE Id = @lca
		INSERT INTO @results VALUES(@current_id)
		WHILE @current_id <> @lca
		BEGIN
			SELECT @current_id=Successor FROM Timelines WHERE Id = @current_id
			INSERT INTO @results VALUES(@current_id)
		END
	END
	ELSE
	BEGIN
		SET @cnt = 0
		WHILE (@cnt < @max_elem)
		BEGIN
			SELECT @current_level_cnt=COUNT(Id) FROM @current_level
			IF @current_level_cnt = 0
				BREAK
			OPEN cur
			FETCH NEXT FROM cur INTO @current_id
			WHILE @@FETCH_STATUS = 0
			BEGIN
				INSERT INTO @results VALUES(@current_id)
				SET @cnt = @cnt + 1
				SELECT @num_ge_min_span=COUNT(Id) FROM (SELECT TOP(1) Id FROM Timelines WHERE Timeline_ID = @current_id AND ToYear - FromYear >= @min_span) AS ChildTimelines
				IF @num_ge_min_span > 0
				BEGIN
					IF @cnt < @max_elem
						INSERT INTO @next_level SELECT Id FROM Timelines WHERE Timeline_ID = @current_id AND ToYear - FromYear >= @min_span AND ((FromYear >= @startTime AND FromYear <= @endTime) OR (ToYear >= @startTime AND ToYear <= @endTime) OR (FromYear <= @startTime AND ToYear >= @endTime) OR (FromYear >= @startTime AND ToYear <= @endTime))
					ELSE
						BREAK
				END 
				FETCH NEXT FROM cur INTO @current_id
			END
			DELETE FROM @current_level
			INSERT INTO @current_level SELECT Id FROM @next_level
			DELETE FROM @next_level
			CLOSE cur 
		END
		DEALLOCATE cur
	END
	SELECT * FROM Timelines WHERE Id IN (SELECT Id FROM @results) ORDER BY Depth 
END
