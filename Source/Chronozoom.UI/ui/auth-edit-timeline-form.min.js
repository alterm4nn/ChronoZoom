var __extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r},CZ;(function(n){(function(t){var i=function(t){function i(i,r){var u=this;t.call(this,i,r);this.saveButton=i.find(r.saveButton);this.deleteButton=i.find(r.deleteButton);this.startDate=new n.UI.DatePicker(i.find(r.startDate));this.endDate=new n.UI.DatePicker(i.find(r.endDate));this.mediaListContainer=i.find(r.mediaListContainer);this.backgroundUrl=i.find(r.backgroundUrl);this.offsetInput=i.find(r.topBoundInput);this.bottomOffsetInput=i.find(r.bottomBoundInput);this.titleInput=i.find(r.titleInput);this.offsetLabels=i.find(r.offsetLabels);this.errorMessage=i.find(r.errorMessage);this.timeline=r.context;this.saveButton.off();this.deleteButton.off();this.titleInput.focus(function(){u.titleInput.hideError()});this.initialize()}return __extends(i,t),i.prototype.initialize=function(){var t=this;this.mediaInput={};this.mediaList=new n.UI.MediaList(this.mediaListContainer,n.Media.mediaPickers,this.mediaInput,this);this.mediaList.container.find("[title='skydrive']").hide();this.saveButton.prop("disabled",!1);n.Authoring.mode==="createTimeline"?(this.deleteButton.hide(),this.titleTextblock.text("Create Timeline"),this.saveButton.text("Create Timeline")):n.Authoring.mode==="editTimeline"?(this.deleteButton.show(),this.titleTextblock.text("Edit Timeline"),this.saveButton.text("Update Timeline"),this.timeline.parent.guid||(this.offsetInput.hide(),this.bottomOffsetInput.hide(),this.offsetLabels.hide())):n.Authoring.mode==="createRootTimeline"?(this.deleteButton.hide(),this.closeButton.hide(),this.titleTextblock.text("Create Root Timeline"),this.saveButton.text("Create Timeline"),this.offsetInput.hide(),this.bottomOffsetInput.hide(),this.offsetLabels.hide()):(console.log("Unexpected authoring mode in timeline form."),this.close());this.isCancel=!0;this.endDate.addEditMode_Infinite();this.titleInput.val(this.timeline.title);this.startDate.setDate(this.timeline.x,!0);this.backgroundUrl.val(this.timeline.backgroundUrl||"");this.timeline.endDate===9999?this.endDate.setDate(this.timeline.endDate,!0):this.endDate.setDate(this.timeline.x+this.timeline.width,!0);$(t.startDate.circaSelector).find("input").prop("checked",this.timeline.FromIsCirca);$(t.endDate.circaSelector).find("input").prop("checked",this.timeline.ToIsCirca);t.timeline.offsetY===null?(t.offsetInput.val(""),t.bottomOffsetInput.val("")):(t.offsetInput.val(t.timeline.offsetY),t.bottomOffsetInput.val(t.timeline.offsetY+t.timeline.Height*100));this.saveButton.click(function(){function f(){var e,o;t.errorMessage.empty();var i=t,f=r?r.width/r.height:null,s=f!==t.timeline.aspectRatio,h=Number(t.offsetInput.val())!==t.timeline.offsetY||Number(t.bottomOffsetInput.val())!==t.timeline.offsetY+t.timeline.Height*100;t.timeline.FromIsCirca=$(t.startDate.circaSelector).find("input").is(":checked");t.timeline.ToIsCirca=$(t.endDate.circaSelector).find("input").is(":checked");t.saveButton.prop("disabled",!0);e=t.offsetInput.val()===""?null:Number(t.offsetInput.val());o=t.bottomOffsetInput.val()===""?null:Number(t.bottomOffsetInput.val())-Number(t.offsetInput.val());n.Authoring.updateTimeline(t.timeline,{title:t.titleInput.val(),start:t.startDate.getDate(),end:t.endDate.getDate(),backgroundUrl:u,aspectRatio:f,offsetY:e,Height:o}).then(function(){i.isCancel=!1;i.close();(s||h)&&(n.VCContent.clear(n.Common.vc.virtualCanvas("getLayerContent")),n.Common.reloadData().done(function(){i.timeline=n.Common.vc.virtualCanvas("findElement",i.timeline.id);i.timeline.animation=null;i.timeline.onmouseclick()}));i.timeline.onmouseclick()},function(n){n!==undefined&&n!==null?i.errorMessage.text(n).show().delay(7e3).fadeOut():i.errorMessage.text("Sorry, internal server error :(").show().delay(7e3).fadeOut();console.log(n)}).always(function(){t.saveButton.prop("disabled",!1)})}function e(){var n=t;n.errorMessage.empty();n.errorMessage.text("Please, set a correct URL for background image.").show().delay(7e3).fadeOut();n.backgroundUrl.val("")}t.errorMessage.empty();var i=!1,r,u=t.backgroundUrl.val().trim();if(i=n.Authoring.validateTimelineData(t.startDate.getDate(),t.endDate.getDate(),t.titleInput.val()),n.Authoring.isNotEmpty(t.titleInput.val())||t.titleInput.showError("Title cannot be empty"),n.Authoring.isIntervalPositive(t.startDate.getDate(),t.endDate.getDate())||(t.errorMessage.text("Time interval cannot be less than one day"),i=!1),/(^(([1-9]{0,1}[0-9](\.[0-9]{1,13}){0,1})|(100))$)|(^$)/.test(t.offsetInput.val())&&/(^(([1-9]{0,1}[0-9](\.[0-9]{1,13}){0,1})|(100))$)|(^$)/.test(t.bottomOffsetInput.val())?(t.offsetInput.val()===""==(t.bottomOffsetInput.val()==="")||(t.errorMessage.text("To select auto mode clear both fields."),i=!1),t.offsetInput.val()!==""&&((Number(t.offsetInput.val())<0||Number(t.bottomOffsetInput.val())<0||Number(t.offsetInput.val())>100||Number(t.bottomOffsetInput.val())>100)&&(t.errorMessage.text("Vertical position must be less than of equal to 100% but more than or equal to 0%"),i=!1),Number(t.offsetInput.val())>=Number(t.bottomOffsetInput.val())&&(t.errorMessage.text("Top position must be less then bottom position"),i=!1))):(t.errorMessage.text('Please enter vertical position in percents or clear the input to select auto mode. For example "0", "100", "45" or "75.85"'),i=!1),i)u!==""?(r=new Image,r.addEventListener("load",f,!1),r.addEventListener("error",e,!1),r.src=u):f();else{t.errorMessage.show().delay(7e3).fadeOut();return}});this.deleteButton.click(function(){if(confirm("Are you sure want to delete timeline and all of its nested timelines and exhibits? Delete can't be undone!"))n.Authoring.removeTimeline(t.timeline),t.close()})},i.prototype.updateMediaInfo=function(){this.backgroundUrl.val(this.mediaInput.uri||"")},i.prototype.show=function(){n.Menus.isDisabled=!0;n.Menus.Refresh();t.prototype.show.call(this,{effect:"slide",direction:"left",duration:500});this.activationSource.addClass("active")},i.prototype.close=function(){var i=this;this.errorMessage.empty();n.Menus.isDisabled=!1;n.Menus.Refresh();t.prototype.close.call(this,{effect:"slide",direction:"left",duration:500,complete:function(){i.endDate.remove();i.startDate.remove();i.titleInput.hideError();i.mediaList.remove()}});this.isCancel&&n.Authoring.mode==="createTimeline"&&(n.VCContent.removeChild(this.timeline.parent,this.timeline.id),n.Common.vc.virtualCanvas("requestInvalidate"));n.Authoring.isActive=!1;this.activationSource.removeClass("active");n.Common.vc.virtualCanvas("showNonRootVirtualSpace")},i}(n.UI.FormUpdateEntity);t.FormEditTimeline=i})(n.UI||(n.UI={}));var t=n.UI})(CZ||(CZ={}));
//# sourceMappingURL=auth-edit-timeline-form.min.js.map
