var ChronoZoom;(function(n){(function(){var t=n.Settings;$.widget("ui.axis",{width:null,height:null,beta:0,delta:1,regime:"",level:1,ticks:null,minorTicks:null,labels:null,mousePosition:null,log10:1/Math.log(10),firstYear:null,startDate:null,endDate:null,markerPosition:-1,doesMarkerMovesOnHover:!0,numberOfThresholds:null,thresholds:null,thresholdVisibility:"no",currentThreshold:-1,showThresholds:null,animation:!1,hideAllTimeout:undefined,highlighted_num:0,_create:function(){var n,t;this.backgroundCanvas=$("<canvas><\/canvas>").appendTo(this.element).addClass("backgroundCanvas"),this.ticksCanvas=$("<canvas><\/canvas>").appendTo(this.element).addClass("ticksCanvas"),this.mouseMarkCanvas=$("<canvas><\/canvas>").appendTo(this.element).addClass("mouseMarkCanvas"),this.thresholdCanvas=$("<canvas><\/canvas>").appendTo(this.element).addClass("thresholdCanvas"),n=this.backgroundCanvas[0],n.width=this.element[0].clientWidth,n.height=this.element[0].clientHeight,n=this.ticksCanvas[0],n.width=this.element[0].clientWidth,n.height=this.element[0].clientHeight,n=this.mouseMarkCanvas[0],n.width=this.element[0].clientWidth,n.height=this.element[0].clientHeight,n=this.thresholdCanvas[0],n.width=this.element[0].clientWidth,n.height=this.element[0].clientHeight,this.width=n.width,this.height=n.height,czVersion=="mobile"?this.showThresholds=!1:czVersion=="main"&&(this.showThresholds=!0),this._loadThresholds(),this.thresholds!=null&&this._setThresholdsVisibility(),t=this,t.element.mouseup(function(n){switch(n.which){case 1:t._mouseUp(n)}}),t.element.mousemove(function(n){t._mouseMove(n)}),t.element.mouseleave(function(){t._mouseLeave()}),this._drawBackground(),this.setRange(maxPermitedTimeRange.left,maxPermitedTimeRange.right)},allowMarkerMovesOnHover:function(n){this.doesMarkerMovesOnHover=n},_init:function(){},_destroy:function(){return this.backgroundCanvas.remove(),this.ticksCanvas.remove(),this.mouseMarkCanvas.remove(),this.thresholdCanvas.remove(),this.element.removeClass("axis"),this},_loadThresholds:function(){var n,t=this;switch(czDataSource){case"db":n="Chronozoom.svc/getthresholds";break;case"relay":n="ChronozoomRelay";break;case"dump":n="ResponseDumpThresholds.txt"}$.ajax({cache:!1,type:"GET",async:!0,dataType:"json",url:n,success:function(n){t._getThresholdsContent(n)},error:function(n){alert("Error connecting to service: "+n.responseText)}})},_getThresholdsContent:function(n){this.numberOfThresholds=n.d.length,this.thresholds=[];for(var t=0;t<this.numberOfThresholds;t++)n.d[t].time=getCoordinateFromDecimalYear(n.d[t].ThresholdYear),this.thresholds[t]={title:n.d[t].Title,description:n.d[t].Description==null?"":n.d[t].Description,time:n.d[t].time,bookmark:n.d[t].BookmarkRelativePath,color:thresholdColors[t%thresholdColors.length],textColor:thresholdTextColors[t%thresholdTextColors.length],isVisible:!1,showing:"left",coordinate:0}},_mouseUp:function(n){var o,s,h,t,i,f;if(this.showThresholds){if(this.doesMarkerMovesOnHover){var i=getXBrowserMouseOrigin(this.element,n),c=(this.options.range.right-this.options.range.left)/this.width,l=this.options.range.right-c*(this.width-i.x);this.setTimeMarker(l)}var r=0,a=axisHeight-gapLabelTick,u=this,v=this.element[0].offsetTop+a,e=!1;if(this.thresholds&&(o=this.thresholdCanvas[0],s=o.getContext("2d"),s.font=axisTextSize-1+" "+axisTextFont,h=!1,this.thresholds!=null))for(t=0;t<this.thresholds.length;t++)this.thresholds[t].isVisible&&(r=this.thresholds[t].coordinate,i=getXBrowserMouseOrigin(this.element,n),i.x>=r-2&&i.x<=r+10&&i.y>=axisHeight-strokeWidth-10&&i.y<=axisHeight-strokeWidth+0&&e!=!0&&(f=0,this.thresholdVisibility=="no"&&(f=1,$("div").is("#threshold"+t)||u._onExpandThreshold(t)),this.thresholdVisibility=="one"&&f==0&&(u._onThresholdsClear(!1),this.thresholdVisibility="no",$("div").is("#threshold"+t)||u._onExpandThreshold(t)),e=!0,h&&(this.thresholdVisibility="one")))}},_mouseMove:function(n){var i,r,f,c;if(this.doesMarkerMovesOnHover){var t=getXBrowserMouseOrigin(this.element,n),l=(this.options.range.right-this.options.range.left)/this.width,a=this.options.range.right-l*(this.width-t.x);this.setTimeMarker(a)}var e=!1,o=2,s=10,u=10,h=this;if(this.thresholds!=null)for(i=0;i<this.thresholds.length;i++)r=this.thresholds[i].coordinate,t.x>=r-o&&t.x<=r+s&&t.y>=axisHeight-strokeWidth-u&&t.y<=axisHeight-strokeWidth+u&&e!=!0?(this.highlighted_num=i,e=!0,f=this.mouseMarkCanvas[0],c=f.getContext("2d"),c.clearRect(0,0,f.width,f.height),h._drawHighlightedCollapsedThreshold(i)):t.x>=r-10*o&&t.x<=r+2*s&&t.y>=axisHeight-strokeWidth-2*u&&t.y<=axisHeight-strokeWidth+2*u&&h._drawCollapsedThreshold(i)},_mouseLeave:function(){var t=this,n;if(this.thresholds!=null)for(n=0;n<this.thresholds.length;n++)t._drawCollapsedThreshold(n)},_showThreshold:function(n){var t=this;$("#threshold"+n).show("slide",{direction:this.thresholds[n].showing},"slow"),this.animation=!1},_hideThresholdCompleted:function(n){var t=this;$("#line"+n).slideUp(thresholdsAnimationTime,function(){t._hideLineCompleted(n)}),$("#threshold"+n).remove()},_hideLineCompleted:function(n){$("#line"+n).remove(),this._onThresholdsClearCompleted()},_hideThresholdsCompleted:function(n,t){var i=this;$("#line"+n).slideUp(thresholdsAnimationTime,function(){var n=parseFloat(this.id.substring(4));i._hideLinesCompleted(n,t)}),$("#threshold"+n).remove()},_hideThresholdsCompletedSpecific:function(n,t){var i=this;$("#line"+n).slideUp(thresholdsAnimationTime,function(){var n=parseFloat(this.id.substring(4));i._hideLinesCompletedSpecific(n,t)}),$("#threshold"+n).remove()},_hideLinesCompleted:function(n,t){$("#line"+n).remove(),t||this._onThresholdsClearCompleted()},_hideLinesCompletedSpecific:function(n){$("#line"+n).remove()},enableThresholds:function(n){!n&&this.showThresholds&&this._onThresholdsClear(!1),this.showThresholds=n},_onExpandThreshold:function(n){var t=this,r=this.element[0].offsetTop+axisHeight-gapLabelTick,i=this.thresholds[n].coordinate;this.currentThreshold=n,$('<div id="line'+n+'">').appendTo(this.element).addClass("thresholdLine").css({width:thresholdWidth,left:this.element[0].offsetLeft+i,top:r,"background-color":this.thresholds[n].color,height:thresholdHeight}),$('<div id="threshold'+n+'" style="color:'+this.thresholds[n].textColor+'"><div style="left: 5px; top: 5px; position: absolute">Threshold '+(n+1)+':<\/div><div id="title" style="left: 15px; top: 17px; position: absolute; color: White;">'+this.thresholds[n].title+'<\/div><div id="desc" style="left: 10px; right: 10px; position: absolute">'+this.thresholds[n].description+'<\/div><div id="bookmark" style="right: 13px; bottom: 25px; position: absolute; color: White; cursor: pointer;">Jump To Threshold -> <\/div><div id="bookmark2" style="right: 13px; bottom: 8px; position: absolute; color: White; cursor: pointer;">Close Threshold <\/div><\/div>').appendTo(this.element).addClass("thresholdDiv").css({"background-color":this.thresholds[n].color,top:r+thresholdHeight,left:this.element[0].offsetLeft+i}),$("#threshold"+n+" #desc").css("top",$("#threshold"+n+" #title").height()+22),$("#threshold"+n).css("height",$("#threshold"+n+" #desc").height()+96),$("#threshold"+n).position().left+$("#threshold"+n).width()>=this.width-450?(this.thresholds[n].showing="right",$("#threshold"+n).css("left",this.element[0].offsetLeft+i-$("#threshold"+n).width()+thresholdWidth)):this.thresholds[n].showing="left",$("#threshold"+n+" #bookmark")[0].addEventListener("mouseup",function(){t.currentThreshold!=-1&&t._onThresholdMouseClick()},!1),$("#threshold"+n+" #bookmark2")[0].addEventListener("mouseup",function(){t.currentThreshold!=-1&&t._onThresholdsClear(!1)},!1),$("#threshold"+n)[0].addEventListener("mousemove",function(){var n=window.event;n&&preventbubble(n),t.setTimeMarker(t.thresholds[t.currentThreshold].time),t.currentThreshold!=-1&&t.setTimeMarker(t.thresholds[t.currentThreshold].time)},!1),$("#threshold"+n).show("slide",{direction:this.thresholds[n].showing},"slow"),t.thresholdVisibility="one"},_onThresholdsClear:function(n){var i=this,t;if(this.thresholdVisibility=="one")for(t=0;t<this.thresholds.length;t++)this.thresholds[t].isVisible&&(this.animation?($("#threshold"+t).remove(),$("#line"+t).remove(),this._onThresholdsClearCompleted()):$("#threshold"+t).slideUp(thresholdsAnimationTime,function(){var t=parseFloat(this.id.substring(9));i._hideThresholdsCompletedSpecific(t,n)}))},_onThresholdsClearCompleted:function(){this.currentThreshold=-1,this.thresholdVisibility="no";var n=this.thresholdCanvas[0],t=n.getContext("2d");t.clearRect(0,0,n.width,n.height)},_onThresholdMouseClick:function(){var t=window.event,n=new $.Event("thresholdBookmarkChanged");n.Bookmark=this.thresholds[this.currentThreshold].bookmark,this.element.trigger(n),this._onThresholdsClear(!1)},_drawBackground:function(){var t=this.backgroundCanvas[0],n=t.getContext("2d"),i;n.clearRect(0,0,t.width,t.height),n.strokeStyle=axisStrokeColor,n.lineWidth=strokeWidth,i=axisHeight-strokeWidth,n.beginPath(),n.moveTo(0,i),n.lineTo(this.width,i),n.closePath(),n.stroke()},_drawCollapsedThresholds:function(){var t=this,n;if(this.thresholds!=null&&this.showThresholds!=!1)for(n=0;n<this.thresholds.length;n++)t._drawCollapsedThreshold(n)},_drawCollapsedThreshold:function(n){var r=this.ticksCanvas[0],t=r.getContext("2d"),i;this.thresholds!=null&&this.showThresholds!=!1&&this.thresholds[n].isVisible&&(i=this.thresholds[n].coordinate,t.fillStyle=this.thresholds[n].color,t.strokeStyle="black",t.beginPath(),t.moveTo(i,axisHeight-strokeWidth),t.lineTo(i+thresholdWidth,axisHeight-strokeWidth),t.lineTo(i+thresholdWidth,axisHeight-strokeWidth-(thresholdHeight-rectangleRadius)),t.quadraticCurveTo(i+thresholdWidth,axisHeight-strokeWidth-thresholdHeight,i+thresholdWidth-rectangleRadius,axisHeight-strokeWidth-thresholdHeight),t.lineTo(i+rectangleRadius,axisHeight-strokeWidth-thresholdHeight),t.quadraticCurveTo(i,axisHeight-strokeWidth-thresholdHeight,i,axisHeight-strokeWidth-(thresholdHeight-rectangleRadius)),t.lineTo(i,axisHeight-strokeWidth),t.closePath(),t.lineWidth=1,t.fill(),t.lineWidth=2,t.stroke())},_drawHighlightedCollapsedThreshold:function(n){var r=this.ticksCanvas[0],t=r.getContext("2d"),i;this.thresholds!=null&&this.showThresholds!=!1&&this.thresholds[n].isVisible&&(i=this.thresholds[n].coordinate,t.fillStyle=this.thresholds[n].color,t.strokeStyle="white",t.lineWidth=1,t.beginPath(),t.moveTo(i,axisHeight-strokeWidth),t.lineTo(i+thresholdWidth,axisHeight-strokeWidth),t.lineTo(i+thresholdWidth,axisHeight-strokeWidth-(thresholdHeight-rectangleRadius)),t.quadraticCurveTo(i+thresholdWidth,axisHeight-strokeWidth-thresholdHeight,i+thresholdWidth-rectangleRadius,axisHeight-strokeWidth-thresholdHeight),t.lineTo(i+rectangleRadius,axisHeight-strokeWidth-thresholdHeight),t.quadraticCurveTo(i,axisHeight-strokeWidth-thresholdHeight,i,axisHeight-strokeWidth-(thresholdHeight-rectangleRadius)),t.lineTo(i,axisHeight-strokeWidth),t.closePath(),t.fill(),t.stroke())},_drawNotCollapsedThresholds:function(){var r=this.ticksCanvas[0],u=r.getContext("2d"),n,i,t;if(u.lineWidth=2,this.thresholds!=null)for(n=0;n<this.thresholds.length;n++)this.thresholds[n].isVisible?$("div").is("#threshold"+n)&&(i=this.thresholds[n].coordinate,$("#line"+n).css("left",this.element[0].offsetLeft+i),this.thresholds[n].showing=="right"?$("#threshold"+n).position().left>=0&&$("#threshold"+n).position().left+$("#threshold"+n).width()<=this.width+5?$("#threshold"+n).css("left",this.element[0].offsetLeft+i-$("#threshold"+n).width()+thresholdWidth):(t=this,$("#threshold"+n).remove(),$("#line"+n).remove(),t._hideThresholdsCompleted(n,!1)):$("#threshold"+n).position().left+$("#threshold"+n).width()<=this.width-7?$("#threshold"+n).css("left",this.element[0].offsetLeft+i):(t=this,$("#threshold"+n).remove(),$("#line"+n).remove(),t._hideThresholdsCompleted(n,!1))):$("div").is("#threshold"+n)&&(t=this,$("#threshold"+n).remove(),$("#line"+n).remove(),t._hideThresholdsCompleted(n,!1))},_drawTicks:function(){var h=this.ticksCanvas[0],n=h.getContext("2d"),i,u,c,f,r;n.clearRect(0,0,h.width,h.height),n.strokeStyle=axisStrokeColor,n.font=axisTextSize+" "+axisTextFont,n.lineWidth=1,i="",i=this.regime=="Ga"?"Billions of Years Ago":this.regime=="Ma"?"Millions of Years Ago":this.regime=="ka"?"Thousands of Years Ago":this.regime,n.strokeText(i,horizontalTextMargin,verticalTextMargin),this.options.mode=="cosmos"&&this.options.range.right>=0?n.strokeText("Today",this.width-horizontalTextMargin-n.measureText("Today").width,verticalTextMargin):n.strokeText(i,this.width-horizontalTextMargin-n.measureText(i).width,verticalTextMargin);var o=0,s=0,e=0,t=0;for(this.options.mode=="date"&&(i=(this.beta<=-2?months[this.startDate.month]+", ":"")+(this.startDate.year>0?this.startDate.year+" CE":-this.startDate.year+(this.startDate.year==0?1:0)+" BCE"),s=n.measureText(i).width+5,n.strokeText(i,5,verticalTextMargin*2),i=(this.beta<=-2?months[this.endDate.month]+", ":"")+(this.endDate.year>0?this.endDate.year+" CE":-this.endDate.year+(this.endDate.year==0?1:0)+" BCE"),e=n.measureText(i).width+5,n.strokeText(i,this.width-e,verticalTextMargin*2)),u=this.width/(this.options.range.right-this.options.range.left),c=-u*this.options.range.left,r=0;r<this.ticks.length;r++)t=u*(this.ticks[r]-this.options.range.left),this.options.mode=="calendar"&&(t+=u*this.firstYear),t<=c&&(n.beginPath(),n.lineWidth=strokeWidth,n.moveTo(t,axisHeight-strokeWidth),n.lineTo(t,axisHeight-strokeWidth-tickLength),n.closePath(),n.stroke(),o=n.measureText(this.labels[r]).width,f=!0,(s!=0||e!=0)&&(s!=0&&t-o/2-5<s&&(f=f&&!1),e!=0&&t+o/2+5>this.width-e&&(f=f&&!1)),f&&(n.lineWidth=1,n.strokeText(this.labels[r],t-o/2,verticalTextMargin*2)));if(this.minorTicks!=null)for(r=0;r<this.minorTicks.length;r++)t=u*(this.minorTicks[r]-this.options.range.left),this.options.mode=="calendar"&&(t+=u*this.firstYear),n.beginPath(),n.lineWidth=strokeWidth,n.moveTo(t,axisHeight-strokeWidth),n.lineTo(t,axisHeight-strokeWidth-smallTickLength),n.closePath(),n.stroke()},_createTicks:function(){var n=this._getTicks(),u=n.ticks,f=n.labels,e=this._checkLabelsArrangement(u,f),t,i,r,o=0;if(e==-1)while(o++<maxTickArrangeIterations){if(this._decreaseTickCount(),n=this._getTicks(),t=n.ticks,i=n.labels,r=this._checkLabelsArrangement(t,i),r==1){this._increaseTickCount();break}if(u=t,f=i,r==0)break}if(e==1)while(o++<maxTickArrangeIterations){if(this._increaseTickCount(),n=this._getTicks(),t=n.ticks,i=n.labels,r=this._checkLabelsArrangement(t,i),r==-1){this._decreaseTickCount();break}if(u=t,f=i,r==0)break}return{ticks:u,labels:f}},_getTicks:function(){var u=[],h=[],o,s,it,n,c,t,a,v,i,w,r,y,b;if(this.options.mode=="cosmos"||this.options.mode=="calendar"){o=Math.max(this.options.range.left,maxPermitedTimeRange.left),s=Math.min(this.options.range.right,maxPermitedTimeRange.right),this.options.mode=="calendar"&&(o-=this.firstYear,s-=this.firstYear),it=s-o,n=this.beta,this.options.mode=="cosmos"?this.regime=="Ga"&&n<5?n=5:this.regime=="Ma"&&n<2?n=2:this.regime=="ka"&&n<-1&&(n=-1):this.options.mode=="calendar"&&n<0&&(n=0);var e=this.delta*Math.pow(10,n),k=Math.floor(o/e),rt=Math.floor(s/e),d=rt-k+1,ut=k*e;for(e==2&&d++,c=0;c<d+1;c++)t=this._round(ut+c*e,n),this.options.mode=="calendar"&&(t<0&&(t+=1),Math.abs(t)<1e-10&&e>1&&t++),t>=o&&t<=s&&t!=u[u.length-1]&&u.push(t);h=this._getLabels(u)}else if(this.options.mode=="date"){for(var g=Math.min(this.options.range.right,0),nt=Math.min(this.options.range.left,0),f=0,tt=0,l=this.startDate.month,p=this.startDate.year;p<this.endDate.year||p==this.endDate.year&&l<=this.endDate.month;)tt++,l++,l==12&&(l=0,p++);for(a=0,this.beta<=-2&&this.beta>=-4&&(f=5),this.beta<=-5&&(f=1),v=this.startDate.year,i=this.startDate.month-1,w=0;w<=tt+2;w++)if(i++,i==12&&(i=0,v++),r=getCoordinateFromDMY(v,i,1),r>=nt&&r<=g&&f!=1&&(h.push(months[i]),u.push(r)),f!=0)for(a=Math.floor(daysInMonth[i]/f),f==5&&daysInMonth[i]>=30&&this.beta==-2&&a--,y=1;y<=a;y++)b=y*f,r=getCoordinateFromDMY(v,i,b),r>=nt&&r<=g&&(h.push(b),u.push(r))}return{ticks:u,labels:h}},_getLabels:function(n){for(var r=[],i,u=Math.max(Math.floor(Math.log(this.delta*Math.pow(10,this.beta)/this.level)*this.log10),-4),t=0;t<n.length;t++)this.options.mode=="cosmos"?(i=-n[t]/this.level,u<0&&(i=new Number(i).toFixed(-u)),(t==0||t==n.length-1)&&(i+=this.regime)):(i=n[t]<=0?-n[t]+1:n[t],(t==0||t==n.length-1||i=="1")&&(i+=n[t]<=0?"BCE":"CE")),r.push(i);return r},_checkLabelsArrangement:function(n,t){var o=this.ticksCanvas[0],r=o.getContext("2d"),i,u,f,e;for(r.font=axisTextSize+" "+axisTextFont,i=0;i<n.length-1;i++)if(u=r.measureText(t[i]).width,f=r.measureText(t[i+1]).width,this._getCoordinateFromTick(n[i])+u/2+spaceBetweenLabels>this._getCoordinateFromTick(n[i+1])-f/2)return-1;for(e=1,i=0;i<n.length-1;i++)if(u=r.measureText(t[i]).width,f=r.measureText(t[i+1]).width,this._getCoordinateFromTick(n[i])+u/2+spaceBetweenLabels>this._getCoordinateFromTick(n[i+1])-f/2){e=0;break}return e},_getCoordinateFromTick:function(n){return(n-this.options.range.left)*this.width/(this.options.range.right-this.options.range.left)},_decreaseTickCount:function(){this.delta==1?this.delta=2:this.delta==2?this.delta=5:this.delta==5&&(this.delta=1,this.beta++),this._setMode()},_increaseTickCount:function(){this.delta==1?(this.delta=5,this.beta--):this.delta==2?this.delta=1:this.delta==5&&(this.delta=2),this._setMode()},_round:function(n,t){var i=1,r;if(t<=0){for(t=Math.max(0,Math.min(-t,15)),i=1,r=0;r>t;r--)i/=10;return Math.round(n*i)/i}for(i=1,r=0;r<t;r++)i*=10;return i*Math.round(n/i)},_setMode:function(){this.options.range.left<=-1e10?(this.regime="Ga",this.options.mode="cosmos",this.level=1e9):this.options.range.left<=-1e7?(this.regime="Ma",this.options.mode="cosmos",this.level=1e6):this.options.range.left<=-1e4?(this.regime="ka",this.options.mode="cosmos",this.level=1e3):this.beta<0?(this.regime="Date",this.options.mode="date",this.level=1):(this.regime="BCE/CE",this.options.mode="calendar",this.level=1)},_createMinorTicks:function(n){var f=[],h=Math.max(this.options.range.left,maxPermitedTimeRange.left),c=Math.min(this.options.range.right,maxPermitedTimeRange.right),s,e,u,l,t,i;this.options.mode=="calendar"&&(h-=this.firstYear,c-=this.firstYear);var o=5,e=this.width/(this.options.range.right-this.options.range.left),a=n.length>1?n[1]-n[0]:0,r=a/(o+1);if(this.options.mode=="cosmos"||this.options.mode=="calendar"){if(e*r<spaceBetweenSmallTicks)return null;for(t=n[0]-r;t>h;)f.push(t),t-=r;for(u=0;u<n.length-1;u++)for(s=n[u],r>1e-10+1/(o+1)&&Math.abs(s-1)<1e-10&&(s=0),e=1;e<=o;e++)t=s+r*e,f.push(t);for(t=n[n.length-1]+r;t<c;)f.push(t),t+=r}else{if(this.beta>=-1)r=5;else if(this.beta<=-2&&this.beta>=-4)r=1;else if(this.beta<=-5)return null;for(t=n[0],i=getDMYFromCoordinate(t),i.day-=r,t=getCoordinateFromDMY(i.year,i.month,i.day);t>h;)f.push(t),i.day-=r,t=getCoordinateFromDMY(i.year,i.month,i.day);for(u=0;u<n.length-1;u++){var t=n[u],i=getDMYFromCoordinate(t),o=Math.floor(daysInMonth[i.month]/r);for(l=1;l<=o;l++)i.day+=r,i.day==r+1&&r!=1&&i.day--,t=getCoordinateFromDMY(i.year,i.month,i.day),(f.length==0||e*(n[u+1]-t)>spaceBetweenSmallTicks)&&f.push(t)}for(t=n[n.length-1],i=getDMYFromCoordinate(t),i.day+=r,t=getCoordinateFromDMY(i.year,i.month,i.day);t<c;)f.push(t),i.day+=r,t=getCoordinateFromDMY(i.year,i.month,i.day)}return f},setRange:function(n,t){var i,r;n<t?(this.options.range.left=n,this.options.range.right=t):(this.options.range.left=maxPermitedTimeRange.left,this.options.range.right=maxPermitedTimeRange.right),i=getPresent(),this.options.present={year:i.getUTCFullYear(),month:i.getUTCMonth(),day:i.getUTCDate()},this.firstYear=getCoordinateFromDMY(0,0,1),this.mode!="cosmos"&&(this.startDate=this.options.present,this.endDate=this.options.present,this.options.range.left<0&&(this.startDate=getDMYFromCoordinate(this.options.range.left)),this.options.range.right<0&&(this.endDate=getDMYFromCoordinate(this.options.range.right))),this.delta=1,this.beta=Math.floor(Math.log(this.options.range.right-this.options.range.left)*this.log10),this._setMode(),this.thresholds!=null&&this._setThresholdsVisibility(),r=this._createTicks(),this.ticks=r.ticks,this.labels=r.labels,this.minorTicks=this._createMinorTicks(this.ticks),this._drawTicks(),this._drawCollapsedThresholds(),this._drawNotCollapsedThresholds(),this._renderMarker()},_setThresholdsVisibility:function(){for(var r=this.width/(this.options.range.right-this.options.range.left),i=0,t,n=0;n<this.numberOfThresholds;n++)this.thresholds[n].time>=this.options.range.left&&this.thresholds[n].time<=this.options.range.right?(this.thresholds[n].isVisible=!0,i=Math.floor(r*(this.thresholds[n].time-this.options.range.left)),this.thresholds[n].coordinate=n==this.numberOfThresholds-1&&i>0?i-thresholdWidth:i):this.thresholds[n].isVisible=!1;for(t=this.thresholds.length-1;t>0&&this.thresholds[t].coordinate-thresholdWidth<=this.thresholds[t-1].coordinate&&this.thresholds[t].isVisible;)this.thresholds[t-1].coordinate=this.thresholds[t].coordinate-thresholdWidth-1,t--;for(n=0;n<t;n++)this.thresholds[n].coordinate+thresholdWidth>=this.thresholds[n+1].coordinate&&this.thresholds[n].isVisible&&(this.thresholds[n+1].coordinate=this.thresholds[n].coordinate+thresholdWidth+1);this.thresholdVisibility=="one"&&($("#threshold"+n).css("left",this.element[0].offsetLeft+this.thresholds[this.currentThreshold].coordinate),$("#line"+n).css("left",this.element[0].offsetLeft+this.thresholds[this.currentThreshold].coordinate))},_renderMarker:function(){var e,n,s,t,f,r,u,o,i;t=this.markerPosition,e=this.mouseMarkCanvas[0],n=e.getContext("2d"),n.clearRect(0,0,e.width,e.height),t>=maxPermitedTimeRange.left&&t<=maxPermitedTimeRange.right&&(s=this.width/(this.options.range.right-this.options.range.left),t=s*(t-this.options.range.left),this.mousePosition=t,n.strokeStyle=axisStrokeColor,n.fillStyle=axisStrokeColor,n.beginPath(),f=axisHeight-strokeWidth,n.moveTo(t,f),n.lineTo(t+activeMarkSize/2,f-activeMarkSize),n.lineTo(t-activeMarkSize/2,f-activeMarkSize),n.lineTo(t,f),n.closePath(),n.fill(),n.font=axisTextSize-1+" "+axisTextFont,this.options.mode=="cosmos"?(u=Math.max(Math.floor(Math.log(this.delta*Math.pow(10,this.beta)/this.level)*this.log10),-4)-1,u>20&&(u=20),u<-20&&(u=-20),r=u<0?new Number(-this.markerPosition/this.level).toFixed(-u):new Number(-this.markerPosition/this.level).toFixed(u)):this.options.mode=="calendar"?(r=parseFloat(new Number(this.markerPosition-this.firstYear).toFixed(2)),r+=r>0?-.5:-1.5,r=Math.round(r),r<0?r=-r:r==0&&(r=1)):(o=getDMYFromCoordinate(this.markerPosition),r=(this.beta>-3?o.month+1+".":"")+o.day),i=n.measureText(r).width,n.fillStyle="Black",n.globalAlpha=.75,n.beginPath(),n.moveTo(t-i+rectangleRadius,verticalTextMargin),n.lineTo(t-i+i*2-rectangleRadius,verticalTextMargin),n.quadraticCurveTo(t-i+i*2,verticalTextMargin,t-i+i*2,verticalTextMargin+rectangleRadius),n.lineTo(t-i+i*2,verticalTextMargin*2+gapLabelTick-rectangleRadius),n.quadraticCurveTo(t-i+i*2,verticalTextMargin*2+gapLabelTick,t-i+i*2-rectangleRadius,verticalTextMargin*2+gapLabelTick),n.lineTo(t-i+rectangleRadius,verticalTextMargin*2+gapLabelTick),n.quadraticCurveTo(t-i,verticalTextMargin*2+gapLabelTick,t-i,verticalTextMargin*2+gapLabelTick-rectangleRadius),n.lineTo(t-i,verticalTextMargin+rectangleRadius),n.quadraticCurveTo(t-i,verticalTextMargin,t-i+rectangleRadius,verticalTextMargin),n.closePath(),n.fill(),n.globalAlpha=1,n.strokeText(r,t-i/2,verticalTextMargin*2))},setTimeMarker:function(n){this.markerPosition=n,this._renderMarker()},getRange:function(){return{left:this.options.range.left,right:this.options.range.right}},Ticks:function(){return this.ticks},Labels:function(){return this.labels},Regime:function(){return this.regime},Mode:function(){return this.options.mode},MarkerPosition:function(){return this.markerPosition},updateWidth:function(){var t=this.element[0].clientWidth,n=this.backgroundCanvas[0],i;n.width=t,n=this.ticksCanvas[0],n.width=t,n=this.mouseMarkCanvas[0],n.width=t,n=this.thresholdCanvas[0],n.width=t,this.width=t,i=this._createTicks(),this.ticks=i.ticks,this.labels=i.labels,this._drawBackground(),this._drawTicks(),this._drawCollapsedThresholds(),this._drawNotCollapsedThresholds()},options:{range:{left:-1,right:0},present:null,mode:null}})})(n.Axis||(n.Axis={}));var t=n.Axis})(ChronoZoom||(ChronoZoom={}))